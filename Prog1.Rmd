Reproducible ResearchProject One -- Todd Flanders
========================================================

# 1 - Loading and preprocessing the data

```{r import dependancies}
library(plyr)
```

Unzip the data.  The zip file activity.zip was part of the original project,
forked from https://github.com/rdpeng/RepData_PeerAssessment1

```{r unzipAndReadData}
unzip("activity.zip")
originaldata <- read.csv("activity.csv")
```

Convert date factor to date
```{r dataConversion}
originaldata$datePosix <- as.POSIXlt(originaldata$date)
```

Add the interval in minutes to the timestamp to get samples in 5 minute intervals

```{r computeTimeStamp}
originaldata$datePosix$min <- originaldata$datePosix$min + originaldata$interval 
```

Add a column for day of week.

```{r addWday}
originaldata$wday <- originaldata$datePosix$wday
```

Create meta variables

```{r createMetaVars}
numDays <- as.integer(max(originaldata$datePosix) - min(originaldata$datePosix)) 
samplesPerDay <- length(originaldata$date) / numDays
```

Analyze missing step data

```{r calulateMissingStepData}
dataDirty <- originaldata[is.na(originaldata$steps),]
dirtyByDay <- ddply(dataDirty[1:2], .(date), numcolwise(length))
```

Here are the days with missing data out of `r samplesPerDay` samples per day:

```{r showtable}
print(dirtyByDay)
rm (dataDirty)
rm (dirtyByDay)
```
 
We will fill in missing values with the mean of the 5 minute interval for 
the day of week (Sun-Sat).

```{r calulateMissingData}

# make a copy so the original data still has missing values
dataClean <- originaldata 

# create lookup table
dataNoMissingValues <- originaldata[!is.na(originaldata$steps),]
averageByIntervalAndWday <- ddply(dataNoMissingValues[c(1,3,5)], .(interval, wday), numcolwise(mean))
averageByIntervalAndWday$steps <- round(averageByIntervalAndWday$steps, digits=0)
rm(dataNoMissingValues)

# create function for looking up missing values
lookupMissingValue <- function(interval, wday) {
  averageByIntervalAndWday[averageByIntervalAndWday$interval==interval & averageByIntervalAndWday$wday==wday,]$steps
}
  
# lookup missing values
for(i in 1:length(dataClean$date)) {
  if(is.na(dataClean$steps[i])) {
    interval <- dataClean$interval[i]
    wday <- dataClean$wday[i]
    dataClean$steps[i] <- lookupMissingValue(interval, wday)
  }
}

```

Summarize total data by day

```{r summarize}
totalsByDay <- ddply(dataClean[1:2], .(date), numcolwise(sum))
```

# 2 - What is mean total number of steps taken per day?

## Make a histogram of the total number of steps taken each day


```{r fig.width=7, fig.height=4}
hist(
  totalsByDay$steps, 
  main="Total Number of Steps Taken Each Day",
  xlab = "steps per day"
)
```

## Calculate and report the mean and median total number of steps taken per day

```{r meanTotalStepsPerDay}
meanStepsPerDay <- round(mean(totalsByDay$steps, na.rm = TRUE), digits = 0)
medianStepsPerDay <- median(totalsByDay$steps, na.rm = TRUE)
```

```{r printMean}
print(meanStepsPerDay)
```

```{r printMedian}
print(medianStepsPerDay)
```

The mean total number of steps taken per day is 
`r prettyNum(meanStepsPerDay,big.mark=",",scientific=F)`.

The median total number of steps taken per day is 
`r prettyNum(medianStepsPerDay,big.mark=",",scientific=F)`.

# 3 - What is the average daily activity pattern?

## Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)

```{r timeseries, fig.width=10, fig.height=4}
# TODO:  Need to average across all days, not break down per day
myts <- ts(dataClean$steps, frequency=samplesPerDay) 
plot(myts, xlab="day", ylab="avg steps for 5-minute interval")
title(main="Steps Taken in 5-Minute Intervals per Day")

```


## Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?

```{r summarizeByInterval}
averageByInterval <- ddply(dataClean[c(1,3)], .(interval), numcolwise(mean))
```


